<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local Government Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 500px; border-radius: 0.75rem; }
    .info-media img, .info-media video { 
      max-width: 100px; 
      max-height: 100px; 
      margin: 2px; 
      border-radius: 0.25rem; 
    }
  </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow p-6 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800">Local Government Dashboard</h1>
    <div class="flex gap-4 items-center">
      <span class="text-gray-600 font-medium">Admin</span>
      <div class="bg-gray-300 rounded-full w-10 h-10"></div>
    </div>
  </header>

  <main class="p-6 max-w-7xl mx-auto flex flex-col gap-6">

    <!-- Filters -->
    <div class="flex flex-wrap gap-4 mb-4">
      <select id="categoryFilter" 
        class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">All Categories</option>
        <option value="roads">Roads</option>
        <option value="electricity">Electricity</option>
        <option value="water">Water</option>
        <option value="sanitation">Sanitation</option>
        <option value="other">Other</option>
      </select>

      <select id="statusFilter" 
        class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option value="">All Status</option>
        <option value="Pending">Pending</option>
        <option value="In Progress">In Progress</option>
        <option value="Resolved">Resolved</option>
      </select>

      <button id="resetFilters" 
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow">
        Reset Filters
      </button>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <!-- Dashboard Cards -->
    <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
      <!-- Complaint cards will be dynamically added here -->
    </div>

  </main>

  <script>
    let map;
    let markers = [];

    function initMap() {
      const cityCenter = [28.7041, 77.1025]; // Delhi center
      map = L.map('map').setView(cityCenter, 12);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      loadMarkers();
    }

    function loadMarkers() {
      // Remove existing markers
      markers.forEach(m => map.removeLayer(m));
      markers = [];

      const complaints = JSON.parse(localStorage.getItem('complaints')) || [];
      const categoryFilter = document.getElementById('categoryFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;

      const dashboard = document.getElementById('dashboard');
      dashboard.innerHTML = '';

      complaints.forEach(c => {
        if(categoryFilter && c.category !== categoryFilter) return;
        if(statusFilter && c.status !== statusFilter) return;

        const [lat, lng] = c.location.split(',').map(Number);

        const marker = L.marker([lat, lng]).addTo(map);

        let mediaHtml = '';
        if (c.media && c.media.length) {
          c.media.forEach(file => {
            if(file.type.startsWith('image/')) 
              mediaHtml += `<img src="${file.data}" />`;
            else if(file.type.startsWith('video/')) 
              mediaHtml += `<video src="${file.data}" controls></video>`;
          });
        }

        const popupContent = `
          <div class="info-window">
            <b>Category:</b> ${c.category}<br>
            <b>Description:</b> ${c.description}<br>
            <b>Status:</b> ${c.status}<br>
            <div class="info-media flex flex-wrap mt-2">${mediaHtml}</div>
          </div>
        `;
        marker.bindPopup(popupContent);
        markers.push(marker);

        // Dashboard card
        const card = document.createElement('div');
        card.className = `bg-white rounded-2xl p-4 shadow hover:shadow-lg transition-all border-l-4 ${
          c.status==='Pending'?'border-yellow-500': c.status==='In Progress'?'border-blue-500':'border-green-500'
        }`;
        card.innerHTML = `
          <p class="font-semibold text-gray-800">Category: ${c.category}</p>
          <p class="text-gray-700 mt-1">Description: ${c.description}</p>
          <p class="text-gray-600 mt-1">Status: <strong>${c.status}</strong></p>
          <p class="text-gray-600 mt-1">Location: ${c.location}</p>
        `;
        dashboard.appendChild(card);
      });
    }

    document.getElementById('categoryFilter').addEventListener('change', loadMarkers);
    document.getElementById('statusFilter').addEventListener('change', loadMarkers);
    document.getElementById('resetFilters').addEventListener('click', () => {
      document.getElementById('categoryFilter').value = '';
      document.getElementById('statusFilter').value = '';
      loadMarkers();
    });

    initMap();
  </script>
</body>
</html>
